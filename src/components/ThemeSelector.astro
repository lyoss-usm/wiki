---
const themes = [
  {
    id: "lyoss-fusion-vivid",
    name: "Fusion Vivid",
    emoji: "ðŸŒŒ",
    description: "Escala 1",
    colors: ["#5b9cf5", "#b855f5", "#00d4ff"],
  },
  {
    id: "lyoss-fusion-vivid-panels",
    name: "Vivid Panels",
    emoji: "ðŸŒŒ",
    description: "Con Nav destacada",
    colors: ["#5b9cf5", "#1f242b", "#b855f5"],
  },
  {
    id: "lyoss-fusion-intense",
    name: "Fusion Intense",
    emoji: "âœ¨",
    description: "Escala 2",
    colors: ["#4e94fa", "#c44df2", "#00dcff"],
  },
  {
    id: "lyoss-fusion-intense-panels",
    name: "Intense Panels",
    emoji: "âœ¨",
    description: "Con Nav destacada",
    colors: ["#4e94fa", "#1f242b", "#c44df2"],
  },
  {
    id: "lyoss-fusion-radiant",
    name: "Fusion Radiant",
    emoji: "ðŸ’Ž",
    description: "Escala 3",
    colors: ["#4890fd", "#cf46f0", "#00e5ff"],
  },
  {
    id: "lyoss-fusion-radiant-panels",
    name: "Radiant Panels",
    emoji: "ðŸ’Ž",
    description: "Con Nav destacada",
    colors: ["#4890fd", "#1f242b", "#cf46f0"],
  },
  {
    id: "lyoss-fusion-surge",
    name: "Fusion Surge",
    emoji: "ðŸ”¥",
    description: "Escala 4",
    colors: ["#408dfe", "#d540f0", "#00edff"],
  },
  {
    id: "lyoss-fusion-surge-panels",
    name: "Surge Panels",
    emoji: "ðŸ”¥",
    description: "Con Nav destacada",
    colors: ["#408dfe", "#1f242b", "#d540f0"],
  },
  {
    id: "lyoss-fusion-electric",
    name: "Fusion Electric",
    emoji: "ðŸ’«",
    description: "Escala 5",
    colors: ["#3b8bff", "#d946ef", "#00f5ff"],
  },
  {
    id: "lyoss-fusion-electric-panels",
    name: "Electric Panels",
    emoji: "ðŸ’«",
    description: "Con Nav destacada",
    colors: ["#3b8bff", "#1f242b", "#d946ef"],
  },
  {
    id: "lyoss-fusion-neon",
    name: "Full Neon",
    emoji: "âš¡",
    description: "MÃ¡ximo NeÃ³n",
    colors: ["#0080ff", "#ff00ff", "#00ffff"],
  },
  {
    id: "lyoss-fusion-neon-panels",
    name: "Neon Panels",
    emoji: "âš¡",
    description: "Con Nav destacada",
    colors: ["#0080ff", "#1f242b", "#ff00ff"],
  },
];
---

<div class="theme-selector">
  <button
    class="theme-toggle"
    id="theme-toggle"
    aria-label="Cambiar tema"
    title="Cambiar tema"
  >
    <svg
      class="theme-icon"
      width="18"
      height="18"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
    >
      <circle cx="12" cy="12" r="4"></circle>
      <path
        d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"
      ></path>
    </svg>
  </button>

  <div class="theme-dropdown" id="theme-dropdown">
    <div class="theme-dropdown-header">
      <span>Seleccionar tema</span>
    </div>
    <div class="theme-options">
      {
        themes.map((theme) => (
          <button
            class="theme-option"
            data-theme-id={theme.id}
            title={theme.description}
          >
            <div class="theme-colors">
              {theme.colors.map((color) => (
                <span class="color-dot" style={`background: ${color}`} />
              ))}
            </div>
            <div class="theme-info">
              <span class="theme-name">{theme.name}</span>
              <span class="theme-desc">{theme.description}</span>
            </div>
            <span class="theme-check">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="3"
              >
                <polyline points="20 6 9 17 4 12" />
              </svg>
            </span>
          </button>
        ))
      }
    </div>
  </div>
</div>

<style>
  .theme-selector {
    position: relative;
  }

  .theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    background: transparent;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .theme-toggle:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
    border-color: var(--accent-primary);
  }

  .theme-dropdown {
    position: absolute;
    top: calc(100% + 8px);
    right: 0;
    width: 240px;
    max-height: 70vh;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-8px);
    transition: all 0.2s ease;
    z-index: 1000;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .theme-dropdown.open {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .theme-dropdown-header {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border-color);
    font-size: 12px;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .theme-options {
    padding: 8px;
    overflow-y: auto;
    flex: 1;
  }

  .theme-options::-webkit-scrollbar {
    width: 6px;
  }

  .theme-options::-webkit-scrollbar-track {
    background: transparent;
  }

  .theme-options::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 3px;
  }

  .theme-options::-webkit-scrollbar-thumb:hover {
    background: var(--text-muted);
  }

  .theme-option {
    display: flex;
    align-items: center;
    gap: 12px;
    width: 100%;
    padding: 10px 12px;
    background: transparent;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.15s ease;
    text-align: left;
  }

  .theme-option:hover {
    background: var(--bg-hover);
  }

  .theme-option.active {
    background: var(--bg-tertiary);
    border: 1px solid var(--accent-primary);
  }

  .theme-colors {
    display: flex;
    gap: 4px;
  }

  .color-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }

  .theme-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .theme-name {
    font-size: 13px;
    font-weight: 500;
    color: var(--text-primary);
  }

  .theme-desc {
    font-size: 11px;
    color: var(--text-muted);
  }

  .theme-check {
    opacity: 0;
    color: var(--accent-primary);
    transition: opacity 0.15s ease;
  }

  .theme-option.active .theme-check {
    opacity: 1;
  }
</style>

<script>
  function initThemeSelector() {
    const toggle = document.getElementById("theme-toggle");
    const dropdown = document.getElementById("theme-dropdown");
    const options = document.querySelectorAll(".theme-option");

    // Cargar tema guardado o usar 'lyoss-core' por defecto
    const savedTheme = localStorage.getItem("wiki-theme") || "lyoss-core";
    setTheme(savedTheme);

    // Toggle dropdown
    toggle?.addEventListener("click", (e) => {
      e.stopPropagation();
      dropdown?.classList.toggle("open");
    });

    // Cerrar al hacer click fuera
    document.addEventListener("click", (e) => {
      if (!dropdown?.contains(e.target as Node) && e.target !== toggle) {
        dropdown?.classList.remove("open");
      }
    });

    // Seleccionar tema
    options.forEach((option) => {
      option.addEventListener("click", () => {
        const themeId = (option as HTMLElement).dataset.themeId;
        if (themeId) {
          setTheme(themeId);
          dropdown?.classList.remove("open");
        }
      });
    });

    function setTheme(themeId: string) {
      // Aplicar tema al HTML
      document.documentElement.setAttribute("data-theme", themeId);

      // Guardar en localStorage
      localStorage.setItem("wiki-theme", themeId);

      // Actualizar UI del selector
      options.forEach((opt) => {
        const optTheme = (opt as HTMLElement).dataset.themeId;
        opt.classList.toggle("active", optTheme === themeId);
      });
    }
  }

  // Inicializar cuando el DOM estÃ© listo
  document.addEventListener("DOMContentLoaded", initThemeSelector);

  // TambiÃ©n inicializar en navegaciÃ³n con View Transitions de Astro
  document.addEventListener("astro:page-load", initThemeSelector);
</script>
